<!-- BookSwap -->
<!DOCTYPE HTML>

<!-- TODO
       DELETE LINK FOR BOTH LISTS
       name/email, have, want updates collapsed into single post
       better URI parsing
  -->

<html>
<head>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
  <script src='http://code.jquery.com/jquery-3.1.0.js'></script>
  <script type='text/javascript' src='aux.js'></script>
  <script type='text/javascript' src='launchReq.js'></script>
  <script language='javascript'>
    // expect object from json
    function updateNameEmail(data){
      $('#nameDiv').html(data.name)
      $('#mailDiv').html(data.email)
    }

    // expect html table
    function updateBooksHave(html){
      $('#haveDiv').html(html)
    }

    // expect html table
    function updateBooksWant(html){
      $('#wantDiv').html(html)
    }

    // tell server to log out
    function doLogout(){
      launchPostReq('logout', loadPage)
    }

    // trx = 'have', 'want'
    function doAddBook(trx){
      // grab user ID from URL FIXME clean this up
      var ID = decodeURIComponent(
                 window.location.search.substring(1).split('=')[1]);
      var titleInp  = '#' + trx + 'TitleInp'
      var authorInp = '#' + trx + 'AuthorInp'
      var isbnInp   = '#' + trx + 'IsbnInp'
      launchPostReq('addBook', loadPage, new argObj('id', ID), 
                               new argObj('title',  $(titleInp ).val()), 
                               new argObj('author', $(authorInp).val()), 
                               new argObj('isbn'  , $(isbnInp  ).val())
                   )
    }

    // Wrapper for add entering
    function wrapKeyup(ev, trx){
      ev.preventDefault()
      if (ev.keyCode == 13){ // enter
        var btn = '#' + trx + 'Btn'
        $(btn).click()
      }
    }

    // on start-up, populate user-specific info
    $(document).ready(function(){
      // grab user ID from URL FIXME clean this up
      var ID = decodeURIComponent(
                 window.location.search.substring(1).split('=')[1]);

      if (ID > 0){
        launchPostReq('User',      updateNameEmail, new argObj('id', ID));
        launchPostReq('booksWant', updateBooksWant, new argObj('id', ID));
        launchPostReq('booksHave', updateBooksHave, new argObj('id', ID));
      }
    })
  </script>
</head>

<body>
  <a href='./index.html'> Home Page </a>
  <a id='logoutLnk' href='#'> Log Out </a>

  <h3> User Profile </h3>
  <div id='nameDiv'> Name  </div><br>
  <div id='mailDiv'> Email </div><br>
  <p> Books I Have <p>
  <div id='haveDiv'></div>
  <p> Books I Want <p>
  <div id='wantDiv'></div>

  <!-- add books you have -->
  <div>
    <p> Have a book? </p>
    <br>
  <form>
    Title:  <input id='haveTitleInp'  type='text'><br>
    Author: <input id='haveAuthorInp' type='text'><br>
    ISBN:   <input id='haveIsbnInp'   type='text'><br>
    <button id='haveBtn' type='button'>Submit</button>  
  </form>
  </div>

  <!-- add books you want -->
  <p> Need a book? </p>
  <br>
  <form>
    Title:  <input id='wantTitleInp'  type='text'><br>
    Author: <input id='wantAuthorInp' type='text'><br>
    ISBN:   <input id='wantIsbnInp'   type='text'><br>
    <button id='wantBtn' type='button'>Submit</button>  
  </form>

  <!-- event handlers -->
  <script language='javascript'>
    alert('here')
    // home page link here
    $('#logoutLnk'    ).click(function(ev){ doLogout() })
    $('#haveBtn'      ).click(function(ev){ doAddBook('have') })
    $('#wantBtn'      ).click(function(ev){ doAddBook('want') })
    $('#haveTitleInp' ).keyup(function(ev){ wrapKeyup(ev, 'have') })
    $('#haveAuthorInp').keyup(function(ev){ wrapKeyup(ev, 'have') })
    $('#haveIsbnInp'  ).keyup(function(ev){ wrapKeyup(ev, 'have') })
    $('#haveTitleInp' ).keyup(function(ev){ wrapKeyup(ev, 'have') })
    $('#wantAuthorInp').keyup(function(ev){ wrapKeyup(ev, 'want') })
    $('#wantIsbnInp'  ).keyup(function(ev){ wrapKeyup(ev, 'want') })
  </script>
</body>
</html>
